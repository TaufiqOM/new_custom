<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Report Template -->
        <template id="report_pre_stuffing_template">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="web.basic_layout">
                        <div class="page">
                            <div class="oe_structure"/>
                            <div class="row">
                                <div class="col-10">
                                    <h2 style="font-weight: bold; margin-bottom: -3px;">Manual Stuffing Checklist PRE STUFFING</h2>
                                    <h5 style="font-weight: bold; margin-bottom: -3px;">
                                        Customer :
                                        <span t-esc="doc.buyer.split('/')[0].strip() if doc.buyer else ''"/>
                                    </h5>
                                </div>
                                <div class="col-2" style="text-align: right">
                                    <t t-if="doc.company_id.logo">
                                        <img t-att-src="'data:image/png;base64,%s' % (doc.company_id.logo.decode())"
                                            style="max-height: 120px; object-fit: contain; margin-top: -23px"
                                            alt="Company Logo"/>
                                    </t>
                                </div>
                            </div>
                            <div class="row" style="margin-top: -23px">
                                <div class="col-8">
                                    <h5 style="font-weight: bold; margin-bottom: -3px;">
                                        <t t-esc="doc.description"/>,
                                        <t t-esc="doc.scheduled_date.strftime('%d %b %Y') if doc.scheduled_date else ''"/>
                                    </h5>
                                    <img t-if="doc.description" t-att-src="'data:image/png;base64,%s' % doc.get_qr_code(doc.description)" style="max-height: 100px; height: auto; border: 2px solid black; border-radius: 5px; margin-bottom: -3px;"/>
                                </div>
                                <div class="col-4" style="font-size: 11px; text-align: right">
                                    <t t-set="now" t-value="datetime.datetime.utcnow() + datetime.timedelta(hours=7)"/>
                                    <span>Printed on :
                                        <t t-esc="now.strftime('%A, %d %b %Y %H:%M:%S')"/> (UTC+7)
                                    </span>
                                    <table class="table table-borderless" style="font-size: 16px; font-weight: bold; width: 100%">
                                        <tr>
                                            <td style="width: 20%; text-align: left">Start</td>
                                            <td style="width: 80%; border-bottom: 1px solid black; text-align: left">:</td>
                                        </tr>
                                        <tr>
                                            <td style="width: 20%; text-align: left">Finish</td>
                                            <td style="width: 80%; border-bottom: 1px solid black; text-align: left">:</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            <t t-set="order_groups" t-value="{}"/>
                            <t t-foreach="doc.picking_ids" t-as="picking">
                                <t t-if="picking.sale_id and picking.sale_id.client_order_ref">
                                    <t t-set="client_ref" t-value="picking.sale_id.client_order_ref"/>
                                    <t t-if="client_ref not in order_groups">
                                        <t t-set="order_groups" t-value="dict(order_groups, **{client_ref: {}})"/>
                                    </t>
                                    <t t-foreach="picking.move_ids" t-as="move">
                                        <t t-set="product_name" t-value="move.product_id.name or 'N/A'"/>
                                        <t t-set="sale_lines" t-value="move.picking_id.sale_id and move.picking_id.sale_id.order_line.filtered(lambda l: l.product_id == move.product_id) or []"/>
                                        <t t-set="info_to_production" t-value="sale_lines and sale_lines[0].info_to_production or '##'"/>
                                        <t t-if="product_name not in order_groups[client_ref]">
                                            <t t-set="order_groups" t-value="dict(order_groups, **{client_ref: dict(order_groups[client_ref], **{product_name: {'qty': 0, 'default_code': move.product_id.default_code or '##', 'due_date': picking.sale_id.due_date_order or '##', 'barcodes': [], 'info_to_production': info_to_production}})})"/>
                                        </t>
                                        <t t-set="current" t-value="order_groups[client_ref][product_name]"/>
                                        <t t-set="new_barcodes" t-value="current['barcodes']"/>
                                        <t t-foreach="move.move_line_ids" t-as="line">
                                            <t t-if="line.lot_id">
                                                <t t-set="new_barcodes" t-value="new_barcodes + [line.lot_id.name]"/>
                                            </t>
                                        </t>
                                        <t t-set="order_groups" t-value="dict(order_groups, **{client_ref: dict(order_groups[client_ref], **{product_name: {'qty': current['qty'] + move.quantity, 'default_code': current['default_code'], 'due_date': current['due_date'], 'barcodes': new_barcodes, 'info_to_production': current['info_to_production']}})})"/>
                                    </t>
                                </t>
                            </t>
                            <!-- TABLE HEADER -->
                            <table class="table table-borderless mt-4" style="font-family: Arial; letter-spacing: 0.05em; table-layout: fixed; width: 100%; border-collapse: collapse;">
                                <colgroup>
                                    <col style="width: 14%"/>
                                    <col style="width: 10%"/>
                                    <col style="width: 10%"/>
                                    <col style="width: 10%"/>
                                    <col style="width: 8%"/>
                                    <col style="width: 8%"/>
                                    <col style="width: 8%"/>
                                    <col style="width: 14%"/>
                                    <col style="width: 18%"/>
                                </colgroup>
                                <thead>
                                    <tr style="background-color: #a0a0a0; color: black; border: 1px solid black; font-size: 16px; line-height: 1;" class="text-center align-middle">
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 14%; padding: 2px 4px;">Due Date</th>
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 10%; padding: 2px 4px;">Order</th>
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 10%; padding: 2px 4px;">Type</th>
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 10%; padding: 2px 4px;">Color</th>
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 8%; padding: 2px 4px;">Qty</th>
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 8%; padding: 2px 4px;">M3 Wood</th>
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 8%; padding: 2px 4px;">M3 Pack</th>
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 14%; padding: 2px 4px;">Description</th>
                                        <th class="text-center" style="border: 1px solid black; font-weight: 900; width: 18%; padding: 2px 4px;">Note</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td colspan="9"></td>
                                    </tr>
                                    <t t-foreach="order_groups" t-as="client_ref">
                                        <t t-set="has_barcodes" t-value="False"/>
                                        <t t-foreach="order_groups[client_ref]" t-as="product_name">
                                            <t t-if="order_groups[client_ref][product_name]['barcodes']">
                                                <t t-set="has_barcodes" t-value="True"/>
                                            </t>
                                        </t>
                                        <t t-if="has_barcodes">
                                            <tr style="background-color: #a0a0a0; color: black; border: 1px solid black; font-size: 14px; line-height: 1;" class="align-middle">
                                                <td style="border: 1px solid black; font-weight: 900; padding: 2px 4px;">
                                                    <t t-esc="client_ref"/>
                                                </td>
                                                <td style="border: 1px solid black; font-weight: 900; padding: 2px 4px;" colspan="6">
                                                    <t t-esc="product_name"/>
                                                </td>
                                                <td style="border: 1px solid black; font-weight: 900; padding: 2px 4px;">
                                                xx
                                                </td>
                                                <td style="border: 1px solid black; font-weight: 900; padding: 2px 4px;">
                                                </td>
                                            </tr>
                                            <t t-foreach="order_groups[client_ref]" t-as="product_name">
                                                <t t-if="order_groups[client_ref][product_name]['barcodes']">
                                                    <tr style="background-color: #cfcfcfff; color: black; border: 1px solid black; font-size: 16px; line-height: 1;" class="align-middle">
                                                        <td style="border: 1px solid black; padding: 2px 4px;" colspan="2">
                                                            <t t-esc="order_groups[client_ref][product_name]['default_code']"/>
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td style="border: 1px solid black; padding: 2px 4px;" colspan="3">
                                                            <t t-esc="product_name"/>
                                                        </td>
                                                    </tr>
                                                    <tr style="border: 1px solid black; font-size: 16px; line-height: 1;" class="align-middle">
                                                        <td colspan="7" style="border: 1px solid black; padding: 2px 4px;">
                                                            <t t-esc="order_groups[client_ref][product_name]['info_to_production']"/>
                                                        </td>
                                                    </tr>
                                                    <tr style="border: 1px solid black; font-size: 16px; line-height: 1;" class="align-middle">
                                                        <td style="border: 1px solid black; padding: 2px 4px;">No</td>
                                                        <td style="border: 1px solid black; padding: 2px 4px; text-align: center">Keterangan</td>
                                                        <td colspan="2" style="border: 1px solid black; padding: 2px 4px; text-align: center"></td>
                                                        <td style="border: 1px solid black; padding: 2px 4px; text-align: center">Nomor Barcode</td>
                                                        <td style="border: 1px solid black; padding: 2px 4px; text-align: center;">IN</td>
                                                        <td style="border: 1px solid black; padding: 2px 4px; text-align: center;">OUT</td>
                                                    </tr>
                                                    <t t-set="counter" t-value="1"/>
                                                    <t t-foreach="range(int(order_groups[client_ref][product_name]['qty']))" t-as="i">
                                                        <tr style="font-size: 16px; line-height: 1; vertical-align: middle">
                                                            <td style="">
                                                                <t t-esc="counter"/>
                                                            </td>
                                                            <td style="border-bottom: 1px solid black; text-align: center"></td>
                                                            <td colspan="2" style=" text-align: center"></td>
                                                            <td style="text-align: center; font-size: 17px">
                                                                <t t-esc="order_groups[client_ref][product_name]['barcodes'][i] if len(order_groups[client_ref][product_name]['barcodes']) > i else '##'"/>
                                                            </td>
                                                            <td style="text-align: center;">
                                                                <div style="display:inline-block; width:20px; height:20px; border:2px solid black; vertical-align:middle;"></div>
                                                            </td>
                                                            <td style="text-align: center;">
                                                                <div style="display:inline-block; width:20px; height:20px; border:2px solid black; vertical-align:middle;"></div>
                                                            </td>
                                                        </tr>
                                                        <t t-set="counter" t-value="counter + 1"/>
                                                    </t>
                                                    <tr>
                                                        <td colspan="7" style="height: 15px"></td>
                                                    </tr>
                                                    <tr style="line-height: 1; vertical-align: middle;">
                                                        <td colspan="4" style=" text-align: center"></td>
                                                        <td style="text-align: right;  padding: 5px 5px; font-size: 17px; font-weight: 900">Total Produk In</td>
                                                        <td style="border: 1px solid black; padding: 5px 5px; text-align: center;">
                                                        </td>
                                                        <td style="text-align: center;">
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="7" style="height: 15px"></td>
                                                    </tr>
                                                </t>
                                            </t>
                                        </t>
                                    </t>
                                    <tr>
                                        <td colspan="7" style="height: 15px; border-bottom: 2px solid black"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="7" style="height: 15px"></td>
                                    </tr>
                                    <tr style="line-height: 1; vertical-align: middle;">
                                        <td colspan="4" style=" text-align: center"></td>
                                        <td style="text-align: right;  padding: 5px 5px; font-size: 17px; font-weight: 900">Total All Produk IN:</td>
                                        <td style="border: 1px solid black; padding: 5px 5px; text-align: center;">
                                                        </td>
                                        <td style="text-align: center;">
                                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <h5 style="font-weight: bold; margin-top: 20px; page-break-before: always;">Extra Item :</h5>
                            <table class="table table-borderless" style="font-family: Arial; letter-spacing: 0.05em; table-layout: fixed; width: 100%; border-collapse: collapse;">
                                <colgroup>
                                    <col style="width: 13%"/>
                                    <col style="width: 47%"/>
                                    <col style="width: 34%"/>
                                    <col style="width: 8%"/>
                                    <col style="width: 8%"/>
                                </colgroup>
                                <thead>
                                    <tr style="background-color: #a0a0a0; color: black; height: 25px; border: 1px solid black; font-size: 16px; line-height: 1; vertical-align: middle" class="text-center">
                                        <th class="text-center" style="height: 25px; border: 1px solid black; font-weight: 900; padding: 2px 4px;">No</th>
                                        <th class="text-center" style="height: 25px; border: 1px solid black; font-weight: 900; padding: 2px 4px;">Nomor Barcode</th>
                                        <th class="text-center" style="height: 25px; border: 1px solid black; font-weight: 900; padding: 2px 4px;">ID Produk</th>
                                        <th class="text-center" style="height: 25px; border: 1px solid black; font-weight: 900; padding: 2px 4px;">IN</th>
                                        <th class="text-center" style="height: 25px; border: 1px solid black; font-weight: 900; padding: 2px 4px;">OUT</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="range(1,21)" t-as="i">
                                        <tr style="font-size: 16px; line-height: 1; vertical-align: middle">
                                            <td style="border: 1px solid black; padding: 2px 4px; text-align: center; height: 25px; vertical-align: middle">
                                                <t t-esc="i"/>
                                            </td>
                                            <td style="border: 1px solid black; padding: 2px 4px; text-align: center; height: 25px;"></td>
                                            <td style="border: 1px solid black; padding: 2px 4px; text-align: center; height: 25px;"></td>
                                            <td style="border: 1px solid black; padding: 2px 4px; text-align: center; height: 25px;"></td>
                                            <td style="border: 1px solid black; padding: 2px 4px; text-align: center; height: 25px;"></td>
                                        </tr>
                                    </t>
                                    <tr>
                                        <td colspan="5" style="height: 15px"></td>
                                    </tr>
                                    <tr style="line-height: 1; vertical-align: middle;">
                                        <td colspan="2" style=" text-align: center"></td>
                                        <td style="text-align: right;  padding: 5px 5px; font-size: 17px; font-weight: 900">Total Produk In :</td>
                                        <td style="border: 1px solid black; padding: 5px 5px; text-align: center;" colspan="2">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="7" style="height: 5px; border-bottom: 2px solid black"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="5" style="height: 5px"></td>
                                    </tr>
                                    <tr style="line-height: 1; vertical-align: middle;">
                                        <td colspan="2" style=" text-align: center"></td>
                                        <td style="text-align: right;  padding: 5px 5px; font-size: 25px; font-weight: 900">Grand Total In :</td>
                                        <td style="border: 1px solid black; padding: 5px 5px; text-align: center;" colspan="2">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table style="width: 100%; margin-top: 40px;" class="table table-borderless">
                                <tr>
                                    <td style="text-align: center; width: 33.33%; padding: 10px;">
                                        <p>Approved By</p>
                                        <div style="height: 60px; border-bottom: 1px solid black; margin-top: 20px;"></div>
                                        <p>Opr. Manual</p>
                                    </td>
                                    <td style="text-align: center; width: 33.33%; padding: 10px;">
                                        <p>Approved By</p>
                                        <div style="height: 60px; border-bottom: 1px solid black; margin-top: 20px;"></div>
                                        <p>Opr. Scan</p>
                                    </td>
                                    <td style="text-align: center; width: 33.33%; padding: 10px;">
                                        <p>Approved By</p>
                                        <div style="height: 60px; border-bottom: 1px solid black; margin-top: 20px;"></div>
                                        <p>Opr. Final Check</p>
                                    </td>
                                </tr>
                            </table>
                            <div class="oe_structure"/>
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>
